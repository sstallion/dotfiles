# vim - vim configuration

# Old habits die hard...
alias vi=vim

# Client-Server
: ${VIM_SERVERNAME:=VIM}

function _vimremote {
	vim --servername $VIM_SERVERNAME $@
}

# Change current directory, optionally opening the directory in the current
# window for browsing with netrw.
function vimcd {
	local edit=1
	while getopts "n" arg; do
		case "$arg" in
		n)
			edit=0
			;;
		esac
	done
	shift $((OPTIND-1))

	cd $1 && _vimremote --remote-expr "execute('cd ${(q)$(pwd)}')" &&
	[[ $edit != 0 ]] && _vimremote --remote .
}

# Search for patterns on the command line using vim-grepper. This requires
# saving the working directory prior to invoking :Grepper to avoid surprises
# after the search completes.
function vimgrep {
	local oldpwd=$(_vimremote --remote-expr "call('getcwd', [])")
	(
		_vimremote --remote-expr "execute('cd ${(q)$(pwd)}')" &&
		_vimremote --remote-expr "Grepper -noprompt -dir cwd -query ${(q)@}')" &&
		_vimremote --remote-expr "execute('cd ${(q)oldpwd}')"
	) &>/dev/null
}

alias vimbuf="_vimremote --remote"
alias vimbufw="_vimremote --remote-wait"

alias vimtab="_vimremote --remote-tab"
alias vimtabw="_vimremote --remote-tab-wait"

# vim: ft=zsh
